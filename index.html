<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TUMBLER - The Lockpick Game</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Chivo+Mono:wght@400;700&family=Karnak+Pro:wght@700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* THEME: Premium Dark Heist */
            --bg-grad-start: #121212;
            --bg-grad-end: #1e293b;
            
            --safe-body: #1e293b;
            --safe-inset: #0f172a;
            --safe-border: #334155;
            
            /* UPDATED PALETTE */
            --color-correct: #6aaa64;  /* NYT Green */
            --color-close: #c9b458;    /* NYT Yellow */
            --color-far: #ef4444;      /* RED (Replaced Gray) */
            
            --text-color: #f8fafc;
            --key-bg: #334155;
            --key-text: #e2e8f0;
        }

        * { box-sizing: border-box; }

        body {
            font-family: 'Chivo Mono', monospace;
            background: linear-gradient(135deg, var(--bg-grad-start) 0%, var(--bg-grad-end) 100%);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            margin: 0;
            padding: 10px;
            user-select: none;
            overflow: hidden;
        }

        /* --- HEADER --- */
        header {
            margin-top: 15px;
            text-align: center;
            margin-bottom: 15px;
            border-bottom: 1px solid #334155;
            padding-bottom: 15px;
            width: 100%;
            max-width: 500px;
        }

        h1 {
            margin: 0;
            font-family: serif;
            font-size: 2.2rem;
            letter-spacing: 1px;
            color: #fff;
            text-transform: capitalize;
            font-weight: 700;
        }

        .sub-text {
            font-size: 0.8rem;
            color: #94a3b8;
            letter-spacing: 1px;
            margin-top: 5px;
            text-transform: uppercase;
        }

        /* --- GAME BOARD --- */
        #game-board {
            position: relative;
            padding: 20px;
            background: var(--safe-body);
            border-radius: 16px;
            box-shadow: 
                inset 0 1px 1px rgba(255, 255, 255, 0.1),
                0 20px 40px rgba(0, 0, 0, 0.5),
                0 0 0 1px var(--safe-border);
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: auto;
        }

        /* Safe Bolts */
        #game-board::before, #game-board::after {
            content: '';
            position: absolute;
            width: 8px;
            height: 8px;
            background: #0f172a;
            border-radius: 50%;
            box-shadow: 0 1px 0 rgba(255,255,255,0.1);
        }
        #game-board::before { top: 10px; left: 10px; }
        #game-board::after { bottom: 10px; right: 10px; }

        .row {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            background: var(--safe-inset);
            padding: 8px;
            border-radius: 30px;
            border: 1px solid rgba(255,255,255,0.03);
            transition: all 0.3s ease;
        }
        
        .row.active {
            box-shadow: 0 0 0 1px rgba(255,255,255,0.15);
            background: #182234;
        }

        /* --- TUMBLERS (Dials) --- */
        .tile {
            width: 58px;
            height: 58px;
            border-radius: 50%; 
            background: 
                repeating-conic-gradient(
                    from 0deg,
                    #334155 0deg 3.46deg,
                    transparent 3.46deg 6.92deg
                ),
                radial-gradient(circle at 30% 30%, #475569, #1e293b);
            border: 2px solid #334155;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-size: 1.8rem;
            font-weight: 700;
            position: relative;
            color: #cbd5e1;
            box-shadow: 0 4px 6px rgba(0,0,0,0.4);
            transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .tile::before {
            content: '';
            position: absolute;
            top: 4px;
            width: 4px;
            height: 6px;
            background: rgba(0,0,0,0.5);
            border-radius: 2px;
        }
        
        .tile::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: radial-gradient(circle at center, transparent 60%, rgba(0,0,0,0.3) 60%, rgba(0,0,0,0.3) 65%, transparent 65%);
            pointer-events: none;
        }

        .tile[data-status="filled"] {
            border-color: #94a3b8;
            color: #fff;
            transform: scale(1.05);
        }

        .letter { z-index: 2; margin-top: 2px; }

        /* --- INDICATORS --- */
        .indicator {
            font-size: 0.8rem;
            position: absolute;
            width: 100%;
            text-align: center;
            opacity: 0;
            font-weight: 700;
            transition: opacity 0.3s;
            text-shadow: 0 2px 4px rgba(0,0,0,0.8);
        }

        /* --- FEEDBACK STATES --- */
        .tile.evaluated {
            transition: 
                transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1),
                background 0.3s,
                border-color 0.3s;
        }

        /* CORRECT (Green) */
        .tile.correct {
            border-color: var(--color-correct);
            color: var(--color-correct);
            box-shadow: 0 0 15px rgba(106, 170, 100, 0.2);
            transform: rotate(360deg);
            z-index: 1;
        }

        /* CLOSE (Yellow) */
        .tile.close {
            border-color: var(--color-close);
            color: var(--color-close);
            z-index: 2;
        }
        .tile.close.up { transform: rotate(15deg); }
        .tile.close.down { transform: rotate(-15deg); }
        .tile.close .indicator { 
            color: var(--color-close); 
            bottom: -20px;
        }

        /* FAR (RED - Updated) */
        .tile.far {
            border-color: var(--color-far);
            color: var(--color-far);
            opacity: 0.9;
            z-index: 3;
        }
        .tile.far.up { transform: rotate(30deg); }
        .tile.far.down { transform: rotate(-30deg); }
        .tile.far .indicator { 
            color: var(--color-far);
            bottom: -20px;
        }

        .tile.evaluated .indicator { opacity: 1; }

        /* --- KEYBOARD (A-Z Layout) --- */
        #keyboard {
            width: 100%;
            max-width: 600px;
            padding: 0 5px;
            margin-bottom: 20px;
        }

        .key-row {
            display: flex;
            width: 100%;
            margin: 0 auto 6px;
            gap: 4px;
            justify-content: center;
        }

        .key {
            font-family: 'Chivo Mono', monospace;
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 50px;
            background-color: var(--key-bg);
            color: var(--key-text);
            font-weight: 700;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            box-shadow: 0 3px 0 #0f172a;
            position: relative;
            font-size: 1rem;
        }
        
        .key:active { transform: translateY(3px); box-shadow: none; }
        
        .key::after {
            content: attr(data-value);
            position: absolute;
            top: 3px;
            right: 5px;
            font-size: 0.7rem;
            color: #64748b;
            font-weight: 700;
        }

        .key.wide { flex: 1.5; font-size: 0.8rem; }
        .key.wide::after { content: ''; }

        /* Key States - ONLY GREEN lights up now */
        .key.correct { 
            background-color: var(--color-correct); 
            color: #fff; 
            border: 1px solid rgba(255,255,255,0.2); 
        }
        /* No styling for .close or .far on keyboard as requested */


        /* --- LEGEND --- */
        .legend {
            display: flex;
            gap: 15px;
            font-size: 0.75rem;
            margin-bottom: 15px;
            background: rgba(15, 23, 42, 0.8);
            padding: 8px 16px;
            border-radius: 20px;
            border: 1px solid rgba(255,255,255,0.05);
        }
        .legend-item { display: flex; align-items: center; gap: 6px; color: #cbd5e1; }
        .dot { width: 8px; height: 8px; border-radius: 50%; }

        #message-container {
            height: 30px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 5px;
        }
        .toast {
            background: #f8fafc;
            color: #0f172a;
            padding: 8px 16px;
            border-radius: 4px;
            font-weight: 700;
            font-size: 0.9rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }
        
        @media (max-width: 600px) {
            .tile { width: 54px; height: 54px; font-size: 1.6rem; }
            .row { gap: 12px; }
            h1 { font-size: 2rem; }
        }

        @media (max-width: 480px) {
            .tile { width: 48px; height: 48px; font-size: 1.4rem; }
            .row { gap: 10px; }
            #game-board { padding: 15px; }
            .key { height: 45px; font-size: 0.9rem; }
            h1 { font-size: 1.8rem; }
            .legend { font-size: 0.7rem; gap: 10px; padding: 6px 12px; }
        }

        @media (max-width: 380px) {
            .tile { width: 44px; height: 44px; font-size: 1.3rem; }
            .row { gap: 8px; }
            #game-board { padding: 12px; }
            .key { height: 42px; font-size: 0.85rem; }
            .key::after { font-size: 0.6rem; }
            h1 { font-size: 1.6rem; }
        }

        @media (max-width: 340px) {
            .tile { width: 40px; height: 40px; font-size: 1.2rem; }
            .row { gap: 6px; }
            #game-board { padding: 10px; }
            .key { height: 40px; font-size: 0.8rem; }
            h1 { font-size: 1.4rem; }
        }

    </style>
</head>
<body>

    <header>
        <h1>Tumbler</h1>
        <div class="sub-text">Crack the code</div>
    </header>

    <div id="message-container"></div>

    <div id="game-board">
        </div>

    <div class="legend">
        <div class="legend-item"><div class="dot" style="background:var(--color-far)"></div> Far</div>
        <div class="legend-item"><div class="dot" style="background:var(--color-close)"></div> Close</div>
        <div class="legend-item"><div class="dot" style="background:var(--color-correct)"></div> Open</div>
    </div>

    <div id="keyboard"></div>

<script>
    const WORD_LIST = [
        "HAWK", "LION", "WOLF", "CART", "JUMP", "FISH", "BIRD", "CODE", "LOCK", "KEYS",
        "READ", "BLUE", "SOUL", "DARK", "MIND", "TIME", "PLAY", "GAME", "LOVE", "HOPE"
    ];

    const TARGET_WORD = WORD_LIST[Math.floor(Math.random() * WORD_LIST.length)];
    const WORD_LENGTH = 4;
    const MAX_TRIES = 6;

    let currentRow = 0;
    let currentTile = 0;
    let guesses = Array(6).fill(null).map(() => Array(4).fill(""));
    let isGameOver = false;

    const board = document.getElementById('game-board');
    const keyboardContainer = document.getElementById('keyboard');
    const messageContainer = document.getElementById('message-container');

    function initGame() {
        console.log("Target Word:", TARGET_WORD);
        createBoard();
        createKeyboard();
        document.addEventListener('keydown', handleKeydown);
        updateActiveRow();
    }

    function createBoard() {
        for (let r = 0; r < MAX_TRIES; r++) {
            const rowDiv = document.createElement('div');
            rowDiv.classList.add('row');
            rowDiv.setAttribute('id', `row-${r}`);
            
            for (let c = 0; c < WORD_LENGTH; c++) {
                const tileDiv = document.createElement('div');
                tileDiv.classList.add('tile');
                tileDiv.setAttribute('id', `row-${r}-tile-${c}`);
                
                const letterSpan = document.createElement('span');
                letterSpan.classList.add('letter');
                tileDiv.appendChild(letterSpan);

                const indicatorSpan = document.createElement('span');
                indicatorSpan.classList.add('indicator');
                tileDiv.appendChild(indicatorSpan);

                rowDiv.appendChild(tileDiv);
            }
            board.appendChild(rowDiv);
        }
    }

    function updateActiveRow() {
        document.querySelectorAll('.row').forEach(row => row.classList.remove('active'));
        if (!isGameOver && currentRow < MAX_TRIES) {
            const row = document.getElementById(`row-${currentRow}`);
            if(row) row.classList.add('active');
        }
    }

    function createKeyboard() {
        const rows = [
            "ABCDEFGHIJ",
            "KLMNOPQRST",
            "UVWXYZ"
        ];
        rows.forEach((rowString, index) => {
            const rowDiv = document.createElement('div');
            rowDiv.classList.add('key-row');
            
            if (index === 2) {
                const enterKey = createKey("ENTER", "wide");
                enterKey.onclick = submitGuess;
                rowDiv.appendChild(enterKey);
            }

            for (let char of rowString) {
                const key = createKey(char, "");
                key.id = `key-${char}`;
                key.onclick = () => addLetter(char);
                rowDiv.appendChild(key);
            }

            if (index === 2) {
                const backKey = createKey("⌫", "wide");
                backKey.onclick = deleteLetter;
                rowDiv.appendChild(backKey);
            }
            keyboardContainer.appendChild(rowDiv);
        });
    }

    function createKey(content, className) {
        const button = document.createElement('button');
        button.textContent = content;
        button.classList.add('key');
        if (className) button.classList.add(className);
        if (!className && content.length === 1) {
            button.setAttribute('data-value', content.charCodeAt(0) - 64);
        }
        return button;
    }

    function addLetter(letter) {
        if (isGameOver) return;
        if (currentTile < WORD_LENGTH) {
            guesses[currentRow][currentTile] = letter;
            const tile = document.getElementById(`row-${currentRow}-tile-${currentTile}`);
            tile.querySelector('.letter').textContent = letter;
            tile.setAttribute('data-status', 'filled');
            currentTile++;
        }
    }

    function deleteLetter() {
        if (isGameOver) return;
        if (currentTile > 0) {
            currentTile--;
            guesses[currentRow][currentTile] = "";
            const tile = document.getElementById(`row-${currentRow}-tile-${currentTile}`);
            tile.querySelector('.letter').textContent = "";
            tile.removeAttribute('data-status');
        }
    }

    function showMessage(msg) {
        messageContainer.innerHTML = `<div class="toast">${msg}</div>`;
        setTimeout(() => messageContainer.innerHTML = '', 2000);
    }

    function submitGuess() {
        if (isGameOver) return;
        if (currentTile < WORD_LENGTH) {
            showMessage("Too short");
            return;
        }
        evaluateGuess(guesses[currentRow]);
    }

    function evaluateGuess(guessArr) {
        const targetArr = TARGET_WORD.split("");
        let correctCount = 0;

        for (let i = 0; i < WORD_LENGTH; i++) {
            const tile = document.getElementById(`row-${currentRow}-tile-${i}`);
            const indicator = tile.querySelector('.indicator');
            const letter = guessArr[i];
            
            const guessVal = letter.charCodeAt(0) - 64;
            const targetVal = targetArr[i].charCodeAt(0) - 64;
            const diff = targetVal - guessVal;
            
            const key = document.getElementById(`key-${letter}`);

            setTimeout(() => {
                tile.classList.add('evaluated');

                if (diff === 0) {
                    tile.classList.add('correct');
                    correctCount++;
                    // Only color keyboard if correct
                    if(key) key.classList.add('correct');
                } else {
                    let symbol = "";
                    let distClass = "";
                    let rotateClass = diff > 0 ? "up" : "down"; 
                    
                    if (Math.abs(diff) > 9) {
                        distClass = "far"; // RED now
                        symbol = diff > 0 ? "▲▲" : "▼▼";
                        // Do NOT color keyboard
                    } else {
                        distClass = "close"; // Yellow
                        symbol = diff > 0 ? "▲" : "▼";
                        // Do NOT color keyboard
                    }

                    tile.classList.add(distClass);
                    tile.classList.add(rotateClass); 
                    indicator.innerHTML = symbol;
                }
            }, i * 200); 
        }

        setTimeout(() => {
            if (correctCount === WORD_LENGTH) {
                showMessage("UNLOCKED");
                isGameOver = true;
                document.getElementById(`row-${currentRow}`).style.borderColor = "#6aaa64";
            } else {
                if (currentRow < MAX_TRIES - 1) {
                    currentRow++;
                    currentTile = 0;
                    updateActiveRow();
                } else {
                    showMessage(TARGET_WORD);
                    isGameOver = true;
                }
            }
        }, WORD_LENGTH * 200 + 300);
    }

    function handleKeydown(e) {
        const key = e.key.toUpperCase();
        if (key === "ENTER") submitGuess();
        else if (key === "BACKSPACE") deleteLetter();
        else if (/^[A-Z]$/.test(key)) addLetter(key);
    }

    initGame();
</script>

</body>
</html>